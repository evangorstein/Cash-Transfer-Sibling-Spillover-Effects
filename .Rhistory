}
finebalancematcheddifs <- c()
for (covariate in continuous) {
difs <- standdifs(covariate, combined, combined_dips_mpop)
finebalancematcheddifs <- c(gendermatcheddifs, difs[2])
}
#Boxplots of standard differences
limits=range(gendermatcheddifs, matcheddifs, unmatcheddifs, finebalancematcheddifs)
par(mfrow = c(1, 4))
boxplot(unmatcheddifs, ylim=limits, xlab="Standard Differences before matching")
boxplot(matcheddifs, ylim=limits, xlab="Standard Differences after matching")
boxplot(gendermatcheddifs, ylim=limits, xlab="Standard Differences after exact gender matching")
boxplot(finebalancematcheddifs, ylim=limits, xlab="Standard Differences after fine balancing on grade difference")
#Boxplots of standard differences
standards<-list(unmatcheddifs, matcheddifs, gendermatcheddifs, finebalancematcheddifs)
names(standards) <- c("Standard Differences \n before matching", "Standard Differences \n after matching",
"Standard Differences after exact gender matching", "Standard Differences after fine balancing on grade difference")
boxplot(standards, ylab="standard differences")
names(standards) <- c("Before matching", "After first match",
"After exact match on gender", "After match with \n fine balancing on grade difference")
boxplot(standards, ylab="standard differences")
#Boxplots of standard differences
standards<-list(unmatcheddifs, matcheddifs, gendermatcheddifs, finebalancematcheddifs)
names(standards) <- c("Before matching", "After first match",
"After exact match on gender", "After match with \n fine balancing on grade difference")
boxplot(standards, ylab="standard differences")
#Boxplots of standard differences
standards<-list(unmatcheddifs, matcheddifs, gendermatcheddifs, finebalancematcheddifs)
names(standards) <- c("Before matching", "After first match",
"After exact match on gender", "After match with \n fine balancing on grade difference")
boxplot(standards, ylab="standard differences")
par(mgp=c(3,2,0))
boxplot(standards, ylab="standard differences")
par(mgp=c(3,2,0), cex.axis=.1)
boxplot(standards, ylab="standard differences")
par(mgp=c(3,2,0), cex.axis=.5)
boxplot(standards, ylab="standard differences")
#Boxplots of standard differences
standards<-list(unmatcheddifs, matcheddifs, gendermatcheddifs, finebalancematcheddifs)
names(standards) <- c("Before \n matching", "After \n first match",
"After exact match \n on gender", "After match with \n fine balancing on grade \n difference")
par(mgp=c(3,2,0), cex.axis=.75)
boxplot(standards, ylab="standard differences")
library(foreign)
setwd("~/Documents/Year1/causalinf/siblingcash")
casheffects <- read.dta("data/publicdata.dta")
library(tidyverse)
##Only keep Suba tertiary experiment
casheffects <- casheffects %>%
filter(!suba | grade >= 9)
## Retain only two sibling households who went to schools that were monitored
## and filled out the follow-up survey
sibs2 <- casheffects %>%
filter(fu_observed==1, survey_selected==1) %>%
group_by(fu_nim_hogar) %>%
mutate(num_rsib=n()) %>%
filter(num_rsib==2)
#Exclude pairs in which both siblings are treated
notbothtreated <- sibs2 %>%
filter(!all(as.logical(treatment)))
#Pairs in which just the older (by grade) sibling is treated:
oldtreatedyoungsib <- notbothtreated %>%
filter(any(as.logical(treatment))) %>%
slice_min(grade, with_ties=F) %>%
filter(treatment==0)
oldtreated <- sibs2 %>%
filter(fu_nim_hogar %in% oldtreatedyoungsib$fu_nim_hogar) %>%
mutate(lowergrade = if (all(grade==min(grade))) row_number(fu_nim_hogar)-1 else grade==min(grade)) %>%
pivot_wider(id_cols=fu_nim_hogar, names_from = lowergrade,
values_from=m_enrolled:school_code)  %>%
ungroup() %>%
mutate(sibtreated=1)
#Pair in which no sibling is treated:
bothuntreated <- notbothtreated %>%
filter(all(!as.logical(treatment))) %>%
mutate(lowergrade = if (all(grade==min(grade))) row_number(fu_nim_hogar)-1 else grade==min(grade)) %>%
pivot_wider(id_cols=fu_nim_hogar, names_from = lowergrade, values_from=m_enrolled:school_code) %>%
ungroup() %>%
mutate(sibtreated=0)
# Combining
combined <- rbind(oldtreated, bothuntreated) %>%
select(1:5, s_estrato=s_estrato_1, s_ingtotal = s_ingtotal_1, s_tpersona=s_tpersona_1,
s_est_civil=s_estcivil_1, s_sexo_1, s_sexo_0, s_puntaje = s_puntaje_1,
s_single=s_single_1, s_edadhead=s_edadhead_1, s_num18 = s_num18_1,
s_yrshead=s_yrshead_1, s_yrs_1, s_yrs_0, s_age_sorteo_0, s_age_sorteo_1,
s_age_sorteo2_0, s_age_sorteo2_1, s_years_back_0, s_years_back_1, s_over_age_0,
s_over_age_1, grade_0, grade_1, s_durables=s_durables_1, s_utilities = s_utilities_1,
s_infraest_hh = s_infraest_hh_1, at_msamean_1, sibtreated)
#Fit model for propensity scores
propfit <- glm(sibtreated ~ s_estrato + s_ingtotal + s_tpersona +
s_est_civil + s_sexo_1 + s_sexo_0 + s_puntaje +
s_single+ s_edadhead+ s_num18+ s_yrshead+ s_yrs_1+ s_yrs_0+
s_age_sorteo_0+ s_age_sorteo_1+ s_age_sorteo2_0+ s_age_sorteo2_1+
s_years_back_0+ s_years_back_1+ s_over_age_0+
s_over_age_1+ grade_0 + grade_1 + s_durables + s_utilities + s_infraest_hh,
family=binomial(), data=combined)
combined <- combined %>%
mutate(propscores=propfit$fitted.values) %>%
mutate(gradedif=grade_0-grade_1) %>%
mutate(youngergend=as.factor(combined$r_be_gene_1=="M"),
oldergend=as.factor(combined$r_be_gene_0=="M"),
genderinteraction = as.numeric(interaction(youngergend, oldergend))-1)
boxplot(propscores~sibtreated, data=combined)
sd(combined$propscores)
#Build covariate matrix
covariates <- c("s_estrato", "s_ingtotal", "s_tpersona", "s_puntaje", "genderinteraction",
"s_single", "s_edadhead", "s_num18", "s_yrshead", "s_yrs_1", "s_yrs_0",
"s_age_sorteo_0", "s_age_sorteo_1", "s_age_sorteo2_0", "s_age_sorteo2_1",
"s_years_back_0", "s_years_back_1", "s_over_age_0",
"s_over_age_1", "gradedif", "s_durables", "s_utilities", "s_infraest_hh")
covariate.matrix <- combined %>%
select(covariates)
sibtreated <- combined$sibtreated
propscores <- combined$propscores
#Build distance matrix
library(DOS2)
dmat <- smahal(sibtreated, covariate.matrix)
dmat.cal <- DOS2::addcaliper(dmat, sibtreated, propscores, caliper=.2)
#Match younger sibs with untreated older sib to younger sibs with treated older sib
library(optmatch)
cashmatch = pairmatch(t(dmat.cal), data=combined)
combined_mpop <- combined %>%
mutate(cashmatch=cashmatch) %>%
filter(!is.na(cashmatch))
##Exact matching for gender
#Younger brother, older brother
malemale <- combined %>%
filter(r_be_gene_0=="M", r_be_gene_1=="M")
dmat.mm <- smahal(malemale$sibtreated, malemale %>% select(covariates, -genderinteraction))
dmat.mm <- DOS2::addcaliper(dmat.mm, malemale$sibtreated, malemale$propscores, caliper=.2)
cashmatch.mm = pairmatch(t(dmat.mm), data=malemale)
malemale_mpop <- malemale %>%
mutate(cashmatch=cashmatch.mm) %>%
filter(!is.na(cashmatch))
#Younger brother, older sister
malefemale <- combined %>%
filter(r_be_gene_0=="F", r_be_gene_1=="M")
dmat.mf <- smahal(malefemale$sibtreated, malefemale %>% select(covariates, -genderinteraction))
dmat.mf <- DOS2::addcaliper(dmat.mf, malefemale$sibtreated, malefemale$propscores, caliper=.2)
cashmatch.mf = pairmatch(t(dmat.mf), data=malefemale)
malefemale_mpop <- malefemale %>%
mutate(cashmatch=cashmatch.mf) %>%
filter(!is.na(cashmatch))
#Younger sister, older brother
femalemale <- combined %>%
filter(r_be_gene_0=="M", r_be_gene_1=="F")
dmat.fm <- smahal(femalemale$sibtreated, femalemale %>% select(covariates, -genderinteraction))
dmat.fm <- DOS2::addcaliper(dmat.fm, femalemale$sibtreated, femalemale$propscores, caliper=.2)
cashmatch.fm = pairmatch(t(dmat.fm), data=femalemale)
femalemale_mpop <- femalemale %>%
mutate(cashmatch=cashmatch.fm) %>%
filter(!is.na(cashmatch))
#Younger sister, older sister
femalefemale <- combined %>%
filter(r_be_gene_0=="F", r_be_gene_1=="F")
dmat.ff <- smahal(femalefemale$sibtreated, femalefemale %>% select(covariates, -genderinteraction))
dmat.ff <- DOS2::addcaliper(dmat.ff, femalefemale$sibtreated, femalefemale$propscores, caliper=.2)
cashmatch.ff = pairmatch(t(dmat.ff), data=femalefemale)
femalefemale_mpop <- femalefemale %>%
mutate(cashmatch=cashmatch.ff) %>%
filter(!is.na(cashmatch))
combined_mpopgender <- rbind(malemale_mpop, malefemale_mpop, femalemale_mpop, femalefemale_mpop)
#Exact match on gender combination of siblings and fine balance on grade difference using DiPs package
library(DiPs)
library(gtools)
covariate.matrix <- covariate.matrix %>%
mutate(gradedif=quantcut(gradedif))
View(covariate.matrix)
covariate.matrix <- covariate.matrix %>%
mutate(gradedif=quantcut(gradedif))
library(gtools)
covariate.matrix <- covariate.matrix %>%
mutate(gradedif=quantcut(gradedif))
View(malemale)
#Build covariate matrix
covariates <- c("fu_nim_hogar", "s_estrato", "s_ingtotal", "s_tpersona", "s_puntaje", "genderinteraction",
"s_single", "s_edadhead", "s_num18", "s_yrshead", "s_yrs_1", "s_yrs_0",
"s_age_sorteo_0", "s_age_sorteo_1", "s_age_sorteo2_0", "s_age_sorteo2_1",
"s_years_back_0", "s_years_back_1", "s_over_age_0",
"s_over_age_1", "gradedif", "s_durables", "s_utilities", "s_infraest_hh")
covariate.matrix <- combined %>%
select(covariates)
covariate.matrix <- covariate.matrix %>%
mutate(gradedif=quantcut(gradedif))
dmat <- smahal(sibtreated, select(covariate.matrix, -fu_nim_hogar))
covariate.matrix <- combined %>%
select(covariates)
dmat <- smahal(sibtreated, select(covariate.matrix, -fu_nim_hogar))
covariate.matrix <- covariate.matrix %>%
mutate(gradedif=quantcut(gradedif)) %>%
select(-genderinteraction)
dmat.mm <- maha_sparse(malemale$sibtreated, covariate.matrix %>%
filter(fu_nim_hogar %in% malemale$fu_nim_hogar))
dmat.mm <- maha_dense(malemale$sibtreated, covariate.matrix %>%
filter(fu_nim_hogar %in% malemale$fu_nim_hogar))
dmat.mm <- maha_sparse(malemale$sibtreated, covariate.matrix %>%
filter(fu_nim_hogar %in% malemale$fu_nim_hogar))
dmat.mm <- maha_sparse(1-malemale$sibtreated, covariate.matrix %>%
filter(fu_nim_hogar %in% malemale$fu_nim_hogar))
dmat.mm <- addcaliper(dmat.mm, 1-malemale$sibtreated, 1-malemale$propscores,
c(negboundary,posboundary))
negboundary = -.2*sd(propscores)
posboundary = .2*sd(propscores)
dmat.mm <- addcaliper(dmat.mm, 1-malemale$sibtreated, 1-malemale$propscores,
c(negboundary,posboundary))
dmat.mm <- maha_sparse(1-malemale$sibtreated, covariate.matrix %>%
filter(fu_nim_hogar %in% malemale$fu_nim_hogar))
head(dmat.mm$d, 50)
dmat.mm <- addcaliper(dmat.mm, 1-malemale$sibtreated, 1-malemale$propscores,
c(negboundary,posboundary))
head(dmat.mm$d, 50)
negboundary = -.5*sd(propscores)
posboundary = .5*sd(propscores)
dmat.mm <- addcaliper(dmat.mm, 1-malemale$sibtreated, 1-malemale$propscores,
c(negboundary,posboundary))
head(dmat.mm$d, 50)
negboundary = -.5*sd(malemale$propscores)
posboundary = .5*sd(malemale$propscores)
dmat.mm <- maha_sparse(1-malemale$sibtreated, covariate.matrix %>%
filter(fu_nim_hogar %in% malemale$fu_nim_hogar))
negboundary = -.5*sd(malemale$propscores)
posboundary = .5*sd(malemale$propscores)
dmat.mm <- addcaliper(dmat.mm, 1-malemale$sibtreated, 1-malemale$propscores,
c(negboundary,posboundary))
head(dmat.mm$d, 50)
View(combined)
covariate.matrix <- covariate.matrix %>%
mutate(gradedif=quantcut(grade_0-grade_1)) %>%
select(-genderinteraction) #Covariate matrix now includes grade difference and lacks gender interaction
#Build covariate matrix
covariates <- c("fu_nim_hogar", "s_estrato", "s_ingtotal", "s_tpersona", "s_puntaje", "genderinteraction",
"s_single", "s_edadhead", "s_num18", "s_yrshead", "s_yrs_1", "s_yrs_0",
"s_age_sorteo_0", "s_age_sorteo_1", "s_age_sorteo2_0", "s_age_sorteo2_1",
"s_years_back_0", "s_years_back_1", "s_over_age_0", "grade_0", "grade_1"
"s_over_age_1", "s_durables", "s_utilities", "s_infraest_hh")
covariate.matrix <- combined %>%
select(covariates)
#Build distance matrix
library(DOS2)
dmat <- smahal(sibtreated, select(covariate.matrix, -fu_nim_hogar))
#Build covariate matrix
covariates <- c("fu_nim_hogar", "s_estrato", "s_ingtotal", "s_tpersona", "s_puntaje", "genderinteraction",
"s_single", "s_edadhead", "s_num18", "s_yrshead", "s_yrs_1", "s_yrs_0",
"s_age_sorteo_0", "s_age_sorteo_1", "s_age_sorteo2_0", "s_age_sorteo2_1",
"s_years_back_0", "s_years_back_1", "s_over_age_0", "grade_0", "grade_1"
"s_over_age_1", "s_durables", "s_utilities", "s_infraest_hh")
#Build covariate matrix
covariates <- c("fu_nim_hogar", "s_estrato", "s_ingtotal", "s_tpersona", "s_puntaje", "genderinteraction",
"s_single", "s_edadhead", "s_num18", "s_yrshead", "s_yrs_1", "s_yrs_0",
"s_age_sorteo_0", "s_age_sorteo_1", "s_age_sorteo2_0", "s_age_sorteo2_1",
"s_years_back_0", "s_years_back_1", "s_over_age_0", "grade_0", "grade_1",
"s_over_age_1", "s_durables", "s_utilities", "s_infraest_hh")
covariate.matrix <- combined %>%
select(covariates)
#Build distance matrix
library(DOS2)
dmat <- smahal(sibtreated, select(covariate.matrix, -fu_nim_hogar))
dmat.cal <- DOS2::addcaliper(dmat, combined$sibtreated, combined$propscores, caliper=.2)
#Basic match
library(optmatch)
cashmatch = pairmatch(t(dmat.cal), data=combined)
combined_mpop <- combined %>%
mutate(cashmatch=cashmatch) %>%
filter(!is.na(cashmatch))
#Fine balance on grade difference and exact match on gender
library(DiPs)
library(gtools)
covariate.matrix <- covariate.matrix %>%
mutate(gradedif=quantcut(grade_0-grade_1)) %>%
select(-genderinteraction) #Covariate matrix now includes grade difference and lacks gender interaction
combined <- combined %>%
mutate(gradedif=quantcut(grade_0-grade_1)) #Combined now includes grade difference
#Younger brother, older brother
malemale <- combined %>%
filter(r_be_gene_0=="M", r_be_gene_1=="M")
dmat.mm <- maha_sparse(1-malemale$sibtreated, covariate.matrix %>%
filter(fu_nim_hogar %in% malemale$fu_nim_hogar))
negboundary = -.5*sd(malemale$propscores)
posboundary = .5*sd(malemale$propscores)
dmat.mm <- addcaliper(dmat.mm, 1-malemale$sibtreated, 1-malemale$propscores,
c(negboundary,posboundary))
cashmatch.mm <- match(1-malemale$sibtreated, dmat.mm, malemale, fine=malemale$gradedif)
View(cashmatch.mm$data)
cashmatch.mm$data %>% group_by(sibtreated, gradedif) %>% summarise(n())
#Younger brother, older brother
malemale <- combined %>%
filter(r_be_gene_0=="M", r_be_gene_1=="M")
dmat.mm <- maha_sparse(1-malemale$sibtreated, covariate.matrix %>%
filter(fu_nim_hogar %in% malemale$fu_nim_hogar))
dmat.mm <- addcaliper(dmat.mm, 1-malemale$sibtreated, 1-malemale$propscores, c(-.5,.5), stdev=T)
cashmatch.mm <- match(1-malemale$sibtreated, dmat.mm, malemale, fine=malemale$gradedif)
#Younger brother, older sister
malefemale <- combined %>%
filter(r_be_gene_0=="F", r_be_gene_1=="M")
dmat.mf <- maha_sparse(1-malefemale$sibtreated, covariate.matrix %>%
filter(fu_nim_hogar %in% malefemale$fu_nim_hogar))
head(dmat.mf$d, 50)
dmat.mf <- addcaliper(dmat.mf, 1-malefemale$sibtreated, 1-malefemale$propscores, c(-.5,.5), stdev=T)
head(dmat.mf$d, 50)
cashmatch.mf <- match(1-malefemale$sibtreated, dmat.mf, malefemale, fine=malefemale$gradedif)
#Younger sister, older brother
femalemale <- combined %>%
filter(r_be_gene_0=="M", r_be_gene_1=="F")
dmat.fm <- maha_sparse(1-femalemale$sibtreated, covariate.matrix %>%
filter(fu_nim_hogar %in% femalemale$fu_nim_hogar))
dmat.fm <- addcaliper(dmat.fm, 1-femalemale$sibtreated, 1-femalemale$propscores, c(-.5,.5), stdev=T)
cashmatch.fm <- match(1-femalemale$sibtreated, dmat.fm, femalemale, fine=femalemale$gradedif)
#Younger sister, older sister
femalefemale <- combined %>%
filter(r_be_gene_0=="F", r_be_gene_1=="F")
dmat.ff <- maha_sparse(1-femalefemale$sibtreated, covariate.matrix %>%
filter(fu_nim_hogar %in% femalefemale$fu_nim_hogar))
dmat.ff <- addcaliper(dmat.fm, 1-femalefemale$sibtreated, 1-femalefemale$propscores, c(-.5,.5), stdev=T)
cashmatch.ff <- match(1-femalefemale$sibtreated, dmat.ff, femalefemale, fine=femalefemale$gradedif)
#Younger sister, older sister
femalefemale <- combined %>%
filter(r_be_gene_0=="F", r_be_gene_1=="F")
dmat.ff <- maha_sparse(1-femalefemale$sibtreated, covariate.matrix %>%
filter(fu_nim_hogar %in% femalefemale$fu_nim_hogar))
dmat.ff <- addcaliper(dmat.ff, 1-femalefemale$sibtreated, 1-femalefemale$propscores, c(-.5,.5), stdev=T)
cashmatch.ff <- match(1-femalefemale$sibtreated, dmat.ff, femalefemale, fine=femalefemale$gradedif)
#Combining
combined_mpopgender <- rbind(cashmatch.mm$data, cashmatch.mf$data, cashmatch.fm$data, cashmatch.ff$data)
rm(combined_mpopgender)
#Combining
combined_dips_mpop <- rbind(cashmatch.mm$data, cashmatch.mf$data, cashmatch.fm$data, cashmatch.ff$data)
View(combined_dips_mpop)
#Function for computing standard differences
library(lazyeval)
standdifs <- function(covariate, prematchdata, postmatchdata) {
presummary <- prematchdata %>%
group_by(sibtreated) %>%
summarise_(mn=interp(~mean(var), var=as.name(covariate)), sd=interp(~sd(var), var=as.name(covariate)))
premeancontrol=presummary$mn[1]
premeantreat=presummary$mn[2]
sdcontrol=presummary$sd[1]
sdtreat=presummary$sd[2]
postsummary <- postmatchdata %>%
group_by(sibtreated) %>%
summarise_(mn=interp(~mean(var), var=as.name(covariate)))
postmeancontrol=postsummary$mn[1]
postmeantreat=postsummary$mn[2]
predif=abs(premeantreat-premeancontrol)/sqrt((sdtreat^2+sdcontrol^2)/2)
postdif=abs(postmeantreat-postmeancontrol)/sqrt((sdtreat^2+sdcontrol^2)/2)
return(c(predif, postdif))
}
#Propensity score balance?
paste("Standard difference of propensity scores before match:", standdifs("propscores", combined, combined)[2])
standdifs <- function(covariate, prematchdata, postmatchdata) {
presummary <- prematchdata %>%
group_by(sibtreated) %>%
summarise(mn=interp(~mean(var), var=as.name(covariate)), sd=interp(~sd(var), var=as.name(covariate)))
premeancontrol=presummary$mn[1]
premeantreat=presummary$mn[2]
sdcontrol=presummary$sd[1]
sdtreat=presummary$sd[2]
postsummary <- postmatchdata %>%
group_by(sibtreated) %>%
summarise(mn=interp(~mean(var), var=as.name(covariate)))
postmeancontrol=postsummary$mn[1]
postmeantreat=postsummary$mn[2]
predif=abs(premeantreat-premeancontrol)/sqrt((sdtreat^2+sdcontrol^2)/2)
postdif=abs(postmeantreat-postmeancontrol)/sqrt((sdtreat^2+sdcontrol^2)/2)
return(c(predif, postdif))
}
#Propensity score balance?
paste("Standard difference of propensity scores before match:", standdifs("propscores", combined, combined)[2])
standdifs <- function(covariate, prematchdata, postmatchdata) {
presummary <- prematchdata %>%
group_by(sibtreated) %>%
summarise_(mn=interp(~mean(var), var=as.name(covariate)), sd=interp(~sd(var), var=as.name(covariate)))
premeancontrol=presummary$mn[1]
premeantreat=presummary$mn[2]
sdcontrol=presummary$sd[1]
sdtreat=presummary$sd[2]
postsummary <- postmatchdata %>%
group_by(sibtreated) %>%
summarise_(mn=interp(~mean(var), var=as.name(covariate)))
postmeancontrol=postsummary$mn[1]
postmeantreat=postsummary$mn[2]
predif=abs(premeantreat-premeancontrol)/sqrt((sdtreat^2+sdcontrol^2)/2)
postdif=abs(postmeantreat-postmeancontrol)/sqrt((sdtreat^2+sdcontrol^2)/2)
return(c(predif, postdif))
}
#Propensity score balance?
paste("Standard difference of propensity scores before match:", standdifs("propscores", combined, combined)[2])
paste("Standard difference of propensity scores for first match:", standdifs("propscores", combined, combined_mpop)[2])
paste("Standard difference of propensity scores for fine balance on grade difference:", standdifs("propscores", combined, combined_dips_mpop)[2])
#Other covariates
continuous =c("s_ingtotal", "s_tpersona", "s_puntaje",
"s_edadhead", "s_num18", "s_yrshead", "s_yrs_1", "s_yrs_0",
"s_age_sorteo_0", "s_age_sorteo_1", "s_age_sorteo2_0",
"s_age_sorteo2_1", "s_years_back_0", "s_years_back_1", "s_durables", "s_utilities", "s_infraest_hh")
unmatcheddifs <- c()
for (covariate in continuous) {
difs=standdifs(covariate, combined, combined_mpop)
unmatcheddifs <- c(unmatcheddifs, difs[1])
}
matcheddifs <- c()
for (covariate in continuous) {
difs <- standdifs(covariate, combined, combined_mpop)
matcheddifs <- c(matcheddifs, difs[2])
}
finebalancematcheddifs <- c()
for (covariate in continuous) {
difs <- standdifs(covariate, combined, combined_dips_mpop)
finebalancematcheddifs <- c(gendermatcheddifs, difs[2])
}
for (covariate in continuous) {
difs <- standdifs(covariate, combined, combined_dips_mpop)
finebalancematcheddifs <- c(finebalancematcheddifs, difs[2])
}
names(standards) <- c("Before \n matching", "Post first match", "Post match with \n
exact matching on gender \n and fine balancing on grade difference")
#Boxplots of standard differences
standards<-list(unmatcheddifs, matcheddifs, finebalancematcheddifs)
names(standards) <- c("Before \n matching", "Post first match", "Post match with \n
exact matching on gender \n and fine balancing on grade difference")
par(mgp=c(3,2,0), cex.axis=.75)
boxplot(standards, ylab="standard differences")
names(standards) <- c("Before \n matching", "Post first match", "Post match with \n exact matching on gender \n and fine balancing on grade difference")
par(mgp=c(3,2,0), cex.axis=.75)
boxplot(standards, ylab="standard differences")
names(standards) <- c("Pre match", "Post first match", "Post second match")
par(mgp=c(3,2,0), cex.axis=.75)
boxplot(standards, ylab="standard differences")
combined_dips_mpop_wide <- combined_dips_mpop %>%
ungroup() %>%
pivot_wider(names_from = mset, values_from=c(at_msamean_1, m_enrolled_1))
View(combined_dips_mpop)
str(combined_dips_mpop)
groups(combined_dips_mpop)
attributes(combined_dips_mpop)
combined_dips_mpop_wide <- combined_dips_mpop %>%
group_by(mset, genderinteraction) %>%
mutate(index = row_number()) %>%
ungroup() %>%
pivot_wider(names_from = index, values_from=c(at_msamean_1, m_enrolled_1))
View(combined_dips_mpop_wide)
combined_dips_mpop_wide <- combined_dips_mpop %>%
group_by(mset, genderinteraction) %>%
mutate(index = row_number()) %>%
ungroup() %>%
pivot_wider(id_cols=c(mset, genderinteraction), names_from = index, values_from=c(at_msamean_1, m_enrolled_1))
View(combined_dips_mpop_wide)
combined_dips_mpop_wide <- combined_dips_mpop %>%
group_by(mset, genderinteraction) %>%
mutate(index = row_number()) %>%
pivot_wider(names_from = index, values_from=c(at_msamean_1, m_enrolled_1))
View(combined_dips_mpop_wide)
combined_dips_mpop_wide <- combined_dips_mpop %>%
group_by(mset, genderinteraction) %>%
mutate(index = row_number()) %>%
ungroup() %>%
pivot_wider(id_cols=c(mset, genderinteraction), names_from = index, values_from=c(at_msamean_1, m_enrolled_1))
View(combined_dips_mpop_wide)
View(bothuntreated)
View(oldtreated)
combined_dips_mpop_wide <- combined_dips_mpop %>%
pivot_wider(id_cols=c(mset, genderinteraction), names_from = sibtreated, values_from=c(at_msamean_1, m_enrolled_1))
combined_dips_mpop_wide <- combined_dips_mpop %>%
pivot_wider(id_cols=c(mset, genderinteraction), names_from = sibtreated, values_from=c(at_msamean_1, m_enrolled_1)) %>%
rename(treatment_attend=at_msamean_1_1, control_attend=at_msamean_1_0, treatment_enroll=m_enrolled_1_1, control_enroll=m_enrolled_1_0)
combined_dips_mpop_wide <- combined_dips_mpop %>%
pivot_wider(id_cols=c(mset, genderinteraction), names_from = sibtreated, values_from=c(at_msamean_1, m_enrolled_1)) %>%
rename(treatment_attend=at_msamean_1_1, control_attend=at_msamean_1_0, treatment_enroll=m_enrolled_1_1, control_enroll=m_enrolled_1_0) %>%
mutate(diff_attend=treatment_attend-control_attend)
combined_dips_results <- combined_dips_mpop %>%
pivot_wider(id_cols=c(mset, genderinteraction), names_from = sibtreated, values_from=c(at_msamean_1, m_enrolled_1)) %>%
rename(treatment_attend=at_msamean_1_1, control_attend=at_msamean_1_0, treatment_enroll=m_enrolled_1_1, control_enroll=m_enrolled_1_0) %>%
mutate(diff_attend=treatment_attend-control_attend)
wilcox.test(combined_dips_resulte$diff_attend)
wilcox.test(combined_dips_results$diff_attend, conf.int = T)
wilcox.test(combined_dips_results$diff_attend, conf.int = T, conf.level = .90)
View(combined_dips_results)
combined_dips_results <- combined_dips_mpop %>%
pivot_wider(id_cols=c(mset, genderinteraction), names_from = sibtreated, values_from=c(at_msamean_1, m_enrolled_1)) %>%
rename(treatment_attend=at_msamean_1_1, control_attend=at_msamean_1_0, treatment_enroll=m_enrolled_1_1, control_enroll=m_enrolled_1_0) %>%
mutate(diff_attend=treatment_attend-control_attend)
control_enroll=filter(combined_dips_results, !is.na(control_enroll, !is.na(treatment_enroll))$control_enroll
control_enroll=filter(combined_dips_results, !is.na(control_enroll), !is.na(treatment_enroll))$control_enroll
control_enroll=filter(combined_dips_results, !is.na(control_enroll), !is.na(treatment_enroll))$control_enroll
treatment_enroll=filter(combined_dips_results, !is.na(control_enroll), !is.na(treatment_enroll))$treatment_enroll
mcnemar.test(control_enroll, treated_enroll)
mcnemar.test(control_enroll, treatment_enroll)
wilcox.test(combined_dips_results$diff_attend, conf.int = T, conf.level = .90)
control_enroll=filter(combined_dips_results, !is.na(control_enroll), !is.na(treatment_enroll))$control_enroll
treatment_enroll=filter(combined_dips_results, !is.na(control_enroll), !is.na(treatment_enroll))$treatment_enroll
mcnemar.test(control_enroll, treatment_enroll)
#For sibling pairs with male younger sibling
combined_dips_results_male <- combined_dips_mpop %>%
filter(r_be_gene_1=="M") %>%
pivot_wider(id_cols=c(mset, genderinteraction), names_from = sibtreated, values_from=c(at_msamean_1, m_enrolled_1)) %>%
rename(treatment_attend=at_msamean_1_1, control_attend=at_msamean_1_0, treatment_enroll=m_enrolled_1_1, control_enroll=m_enrolled_1_0) %>%
mutate(diff_attend=treatment_attend-control_attend)
View(combined_dips_results_male)
wilcox.test(combined_dips_results_male$diff_attend, conf.int = T, conf.level = .90)
wilcox.test(combined_dips_results$diff_attend, conf.int = T, conf.level = .90)
wilcox.test(combined_dips_results_male$diff_attend, conf.int = T, conf.level = .90)
#For sibling pairs with female younger sibling
combined_dips_results_female <- combined_dips_mpop %>%
filter(r_be_gene_1=="F") %>%
pivot_wider(id_cols=c(mset, genderinteraction), names_from = sibtreated, values_from=c(at_msamean_1, m_enrolled_1)) %>%
rename(treatment_attend=at_msamean_1_1, control_attend=at_msamean_1_0, treatment_enroll=m_enrolled_1_1, control_enroll=m_enrolled_1_0) %>%
mutate(diff_attend=treatment_attend-control_attend)
wilcox.test(combined_dips_results_female$diff_attend, conf.int = T, conf.level = .90)
control_enroll_male=filter(combined_dips_results_male, !is.na(control_enroll), !is.na(treatment_enroll))$control_enroll
treatment_enroll_male=filter(combined_dips_results_male, !is.na(control_enroll), !is.na(treatment_enroll))$treatment_enroll
mcnemar.test(control_enroll_male, treatment_enroll_male) #enrollment
control_enroll_female=filter(combined_dips_results_female, !is.na(control_enroll), !is.na(treatment_enroll))$control_enroll
treatment_enroll_female=filter(combined_dips_results_female, !is.na(control_enroll), !is.na(treatment_enroll))$treatment_enroll
mcnemar.test(control_enroll_female, treatment_enroll_female) #enrollment
